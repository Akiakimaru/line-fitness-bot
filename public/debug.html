<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Debug - フィットネス管理</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-up { animation: fadeInUp 0.6s ease-out; }
    .glass-effect {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-gray-100 to-slate-200 min-h-screen">
  <!-- Header -->
  <div class="bg-gradient-to-r from-gray-700 via-gray-800 to-black text-white py-8 px-4 sm:px-6 lg:px-8 shadow-xl">
    <div class="max-w-7xl mx-auto animate-fade-in-up">
      <h1 class="text-3xl sm:text-4xl font-bold flex items-center gap-3">
        <span class="text-4xl">🐛</span>
        <span>デバッグページ</span>
      </h1>
      <p class="mt-2 text-gray-300 text-lg">システム診断とトラブルシューティング</p>
    </div>
  </div>
  
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- URLパラメータ -->
    <div class="glass-effect rounded-2xl p-6 shadow-xl border border-white/20 mb-6 animate-fade-in-up">
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
        </svg>
        <span>URLパラメータ</span>
      </h3>
      <div id="url-params" class="bg-gray-50 rounded-xl p-4 border border-gray-200">
        <pre class="text-sm text-gray-700 overflow-x-auto"></pre>
      </div>
    </div>
    
    <!-- 静的ファイル読み込みテスト -->
    <div class="glass-effect rounded-2xl p-6 shadow-xl border border-white/20 mb-6 animate-fade-in-up" style="animation-delay: 0.1s;">
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <span>静的ファイル読み込みテスト</span>
      </h3>
      <div id="static-files" class="space-y-2"></div>
    </div>
    
    <!-- API接続テスト -->
    <div class="glass-effect rounded-2xl p-6 shadow-xl border border-white/20 mb-6 animate-fade-in-up" style="animation-delay: 0.2s;">
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
        <span>API接続テスト</span>
      </h3>
      <div id="api-test" class="space-y-2"></div>
    </div>
  </div>
  
  <script>
    // URLパラメータ表示
    const params = new URLSearchParams(window.location.search);
    const urlParamsDiv = document.getElementById('url-params');
    
    const paramObj = {};
    for (const [key, value] of params.entries()) {
      paramObj[key] = value;
    }
    
    const preTag = urlParamsDiv.querySelector('pre');
    preTag.textContent = JSON.stringify(paramObj, null, 2);
    
    if (Object.keys(paramObj).length === 0) {
      urlParamsDiv.innerHTML += '<div class="mt-3 px-4 py-3 bg-amber-50 border-l-4 border-amber-500 rounded text-amber-900 text-sm">⚠️ URLパラメータが検出されませんでした。マイページからアクセスしてください。</div>';
    }
    
    // 静的ファイル読み込みテスト
    const staticFilesDiv = document.getElementById('static-files');
    const testFiles = [
      '/styles/common.css',
      '/scripts/common.js',
      '/scripts/mypage.js'
    ];
    
    testFiles.forEach(file => {
      fetch(file)
        .then(response => {
          const statusClass = response.ok ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800';
          const icon = response.ok ? '✅' : '❌';
          staticFilesDiv.innerHTML += `
            <div class="${statusClass} border-l-4 rounded px-4 py-2 text-sm">
              <span class="font-mono">${icon} ${file}</span>
              <span class="ml-2 text-xs opacity-75">(${response.status} ${response.statusText})</span>
            </div>
          `;
        })
        .catch(error => {
          staticFilesDiv.innerHTML += `
            <div class="bg-red-50 border-l-4 border-red-200 rounded px-4 py-2 text-sm text-red-800">
              <span class="font-mono">❌ ${file}</span>
              <span class="ml-2 text-xs opacity-75">(Error: ${error.message})</span>
            </div>
          `;
        });
    });
    
    // API接続テスト
    const apiTestDiv = document.getElementById('api-test');
    const uid = params.get('uid');
    const exp = params.get('exp');
    const sig = params.get('sig');
    
    if (uid && exp && sig) {
      fetch(`/user/logs?uid=${encodeURIComponent(uid)}&exp=${encodeURIComponent(exp)}&sig=${encodeURIComponent(sig)}&days=7`)
        .then(response => response.json())
        .then(data => {
          const statusClass = data.ok ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800';
          const icon = data.ok ? '✅' : '❌';
          apiTestDiv.innerHTML = `
            <div class="${statusClass} border-l-4 rounded px-4 py-3">
              <div class="font-semibold mb-2">${icon} /user/logs</div>
              <pre class="text-xs overflow-x-auto bg-white/50 rounded p-2 mt-2">${JSON.stringify(data, null, 2)}</pre>
            </div>
          `;
        })
        .catch(error => {
          apiTestDiv.innerHTML = `
            <div class="bg-red-50 border-l-4 border-red-200 rounded px-4 py-3 text-red-800">
              <div class="font-semibold mb-2">❌ /user/logs</div>
              <div class="text-sm">Error: ${error.message}</div>
            </div>
          `;
        });
    } else {
      apiTestDiv.innerHTML = '<div class="bg-amber-50 border-l-4 border-amber-500 rounded px-4 py-3 text-amber-900 text-sm">⚠️ URLパラメータが不足しているため、API接続テストはスキップされました。</div>';
    }
  </script>
</body>
</html>
